# For use with docker, build this image and use it
#image: sgpp_img

stages:
  - build
  - tests
  - switches
  - doc


Compile Standard:
  stage: build
  script:
    - scons -j $(nproc) VERBOSE=1 COMPILER=gnu ARCH=avx OPT=0 PYDOC=0
  tags:
    - ubuntu
    - gcc
    - scons
    - swig
    - avx
  only:
    - branches


#Compile Intel:
#  stage: tests
#  script:
#    - . /opt/intel/bin/compilervars.sh intel64
#    - scons -j $(nproc) VERBOSE=1 COMPILER=Intel ARCH=avx OPT=1 PYDOC=0
#  tags:
#    - ubuntu
#    - intel
#    - scons
#    - swig
#    - avx
#  only:
#    - master


#TODO validate scons flags
#Compile OSX:
#  stage: tests
#  script:
#    - scons -j4 CXX="g++-5" CC="g++-5" COMPILER=GNU ARCH=SSE3 VERBOSE=1 OPT=1 PYDOC=0 NO_UNIT_TESTS=1 SG_JAVA=0 CPPFLAGS="-D_GLIBCXX_USE_CXX11_ABI=0" RUN_BOOST_TESTS=0
#  tags:
#    - osx
#    - gcc
#    - scons
#    - swig
#    - sse3
#  only:
#    - master


Test PYDOC:
  stage: switches
  script:
    - scons -j $(nproc) VERBOSE=1 COMPILER=gnu ARCH=avx OPT=0 PYDOC=1 COMPILE_BOOST_TESTS=0
  tags:
    - ubuntu
    - gcc
    - scons
    - swig
    - avx
  only:
    - master


Test SinglePrecision:
  stage: switches
  script:
    - scons -j $(nproc) VERBOSE=1 COMPILER=gnu ARCH=avx OPT=1 PYDOC=0 USE_DOUBLE_PRECISION=0
  tags:
    - ubuntu
    - gcc
    - scons
    - swig
    - avx
  only:
    - master


Test StaticLib:
  stage: switches
  script:
    - scons -j $(nproc) VERBOSE=1 COMPILER=gnu ARCH=avx OPT=1 PYDOC=0 USE_STATICLIB=1
  tags:
    - ubuntu
    - gcc
    - scons
    - swig
    - avx
  only:
    - master


##############################################
#TODO all of these
##############################################

#Compile Win32-msvc:
#  stage: tests
#  script:
#    - scons COMPILER=vcc ARCH=sse3 PYDOC=0 VERBOSE=1 SG_PARALLEL=0 SG_COMBIGRID=0 MSVC_USE_SCRIPT="C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin\vcvars32.bat"
#  tags:
#    - windows
#    - msvc
#    - scons
#    - swig
#    - sse3
#  only:
#    - master

#Test Win32-msvc-StaticLib:
#  stage: switches
#  script:
#    - scons COMPILER=vcc ARCH=sse3 PYDOC=0 VERBOSE=1 USE_STATICLIB=1 SG_PARALLEL=0 SG_COMBIGRID=0 MSVC_USE_SCRIPT="C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin\vcvars32.bat"
#  tags:
#    - windows
#    - msvc
#    - scons
#    - swig
#    - sse3
#  only:
#    - master


Build Documentation:
  stage: doc
  script:
    - scons -h #generating the Doxyfile
    - doxygen Doxyfile
    - cat doxygen_warnings.log
  tags:
    - doxygen
    - scons
  only:
    - master


#Style Guide:
#  stage: doc
#  script:
#    - exit 1
#  tags:
#    - someflagforstylechecking
#  only:
#    - master



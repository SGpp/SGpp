# Copyright (C) 2009 Technische Universitaet Muenchen
# This file is part of the SG++ project. For conditions of distribution and
# use, please see the copyright notice at http://www5.in.tum.de/SGpp

# author Dirk Pflueger (Dirk.Pflueger@in.tum.de)

Import('env pysgpp')

test_env = env.Clone()
# install prerequisites to tests directory
ti = env.Install('#/tests/', ['#/tmp/build_pysgpp/pysgpp.py', '#/bin/tools.py'])

# don't copy _pysgpp.so to the #/tests/ directory to avoid loading the same library twice
# (i.e. bad for singleton instances), link instead
env.Tool('symlink')
# dirty solution, not directly using the library name would be more appropriate,
# but I (Julian Valentin) am lacking the SCons skills for that (TODO)
ti.extend(env.SymLink('#/tests/_pysgpp.so', '#/bin/_pysgpp.so'))

# run tests
bld = Builder(action = "python $SOURCE")
test_env.Append(BUILDERS = {'Test' : bld})
tests = test_env.Test('test_pysgpp.py')
Requires(tests, ti)
AlwaysBuild(tests) 

test_env.Alias('test', tests)

